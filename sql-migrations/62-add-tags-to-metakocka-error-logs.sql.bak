-- Migration: Add tags column to metakocka_error_logs table
-- Description: Adds a tags array column to store categorization tags for error logs

BEGIN;

-- Add tags column to metakocka_error_logs table
ALTER TABLE metakocka_error_logs
ADD COLUMN IF NOT EXISTS tags TEXT[] DEFAULT '{}'::TEXT[];

-- Update RLS policies to include the new column
ALTER TABLE metakocka_error_logs ENABLE ROW LEVEL SECURITY;

-- Drop existing policies if they exist
DROP POLICY IF EXISTS metakocka_error_logs_tenant_isolation ON metakocka_error_logs;

-- Create new policy that includes the tags column
CREATE POLICY metakocka_error_logs_tenant_isolation ON metakocka_error_logs
    USING (tenant_id = auth.uid());

COMMIT;
